

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Topics: Top-K and Self Joins &mdash; Ibis 1.1.0+10.g3a62abe documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced Topics: Additional Filtering" href="7-Advanced-Topics-ComplexFiltering.html" />
    <link rel="prev" title="IO, CREATE/INSERT, and External Data" href="5-IO-Create-Insert-External-Data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Ibis
          

          
            
            <img src="../../_static/logo-wide.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1.0+10.g3a62abe
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Installation and Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuring Ibis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../impala.html">Using Ibis with Impala</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-Intro-and-Setup.html">Impala/HDFS intro and Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Basics-Aggregate-Filter-Limit.html">Basics: Aggregation, filtering, limits</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-Projection-Join-Sort.html">Projection, Joining, and Sorting</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-More-Value-Expressions.html">More Value Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-IO-Create-Insert-External-Data.html">IO, <code class="docutils literal notranslate"><span class="pre">CREATE</span></code>/<code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, and External Data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced Topics: Top-K and Self Joins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#“Top-K”-Filtering">“Top-K” Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Self-joins">Self joins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="7-Advanced-Topics-ComplexFiltering.html">Advanced Topics: Additional Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="8-More-Analytics-Helpers.html">Additional Analytics Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="9-Adding-a-new-elementwise-expression.html">Extending Ibis Part 1: Adding a New Elementwise Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-Adding-a-new-reduction-expression.html">Extending Ibis Part 2: Adding a New Reduction Expression</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql.html">Ibis for SQL Programmers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../udf.html">User Defined Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to Ibis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending.html">Extending Ibis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../backends.html">Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-pre-1.0.html">Release Notes (pre 1.0)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../legal.html">Legal</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ibis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../tutorial.html">Tutorial</a> &raquo;</li>
        
      <li>Advanced Topics: Top-K and Self Joins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/notebooks/tutorial/6-Advanced-Topics-TopK-SelfJoins.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Advanced-Topics:-Top-K-and-Self-Joins">
<h1>Advanced Topics: Top-K and Self Joins<a class="headerlink" href="#Advanced-Topics:-Top-K-and-Self-Joins" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ibis</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">hdfs_port</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IBIS_WEBHDFS_PORT&#39;</span><span class="p">,</span> <span class="mi">50070</span><span class="p">)</span>
<span class="n">hdfs</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">hdfs_connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;impala&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">hdfs_port</span><span class="p">)</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">impala</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;impala&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;ibis_testing&#39;</span><span class="p">,</span>
                          <span class="n">hdfs_client</span><span class="o">=</span><span class="n">hdfs</span><span class="p">)</span>
<span class="n">ibis</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="“Top-K”-Filtering">
<h2>“Top-K” Filtering<a class="headerlink" href="#“Top-K”-Filtering" title="Permalink to this headline">¶</a></h2>
<p>A common analytical pattern involves subsetting based on some method of ranking. For example, “the 5 most frequently occurring widgets in a dataset”. By choosing the right metric, you can obtain the most important or least important items from some dimension, for some definition of important.</p>
<p>To carry out the pattern by hand involves the following</p>
<ul class="simple">
<li><p>Choose a ranking metric</p></li>
<li><p>Aggregate, computing the ranking metric, by the target dimension</p></li>
<li><p>Order by the ranking metric and take the highest K values</p></li>
<li><p>Use those values as a set filter (either with <code class="docutils literal notranslate"><span class="pre">semi_join</span></code> or <code class="docutils literal notranslate"><span class="pre">isin</span></code>) in your next query</p></li>
</ul>
<p>For example, let’s look at the TPC-H tables and find the 5 or 10 customers who placed the most orders over their lifetime:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">orders</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_orders&#39;</span><span class="p">)</span>

<span class="n">top_orders</span> <span class="o">=</span> <span class="p">(</span><span class="n">orders</span>
              <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;o_custkey&#39;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">size</span><span class="p">()</span>
              <span class="o">.</span><span class="n">sort_by</span><span class="p">((</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
              <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">top_orders</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_4_0.png" src="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_4_0.png" />
</div>
</div>
<p>Now, we could use these customer keys as a filter in some other analysis:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Among the top 5 most frequent customers, what&#39;s the histogram of their order statuses?</span>
<span class="n">analysis</span> <span class="o">=</span> <span class="p">(</span><span class="n">orders</span><span class="p">[</span><span class="n">orders</span><span class="o">.</span><span class="n">o_custkey</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_orders</span><span class="o">.</span><span class="n">o_custkey</span><span class="p">)]</span>
            <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;o_orderstatus&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">size</span><span class="p">())</span>
<span class="n">analysis</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_6_0.png" src="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_6_0.png" />
</div>
</div>
<p>This is such a common pattern that Ibis supports a high level primitive <code class="docutils literal notranslate"><span class="pre">topk</span></code> operation, which can be used immediately as a filter:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">top_orders</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="n">o_custkey</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">orders</span><span class="p">[</span><span class="n">top_orders</span><span class="p">]</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;o_orderstatus&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_8_0.png" src="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_8_0.png" />
</div>
</div>
<p>This goes a little further. Suppose now we want to rank customers by their total spending instead of the number of orders, perhaps a more meaningful metric:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">total_spend</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="n">o_totalprice</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span>
<span class="n">top_spenders</span> <span class="o">=</span> <span class="p">(</span><span class="n">orders</span>
                <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;o_custkey&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">total_spend</span><span class="p">)</span>
                <span class="o">.</span><span class="n">sort_by</span><span class="p">((</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span>
                <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">top_spenders</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_10_0.png" src="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_10_0.png" />
</div>
</div>
<p>To use another metric, just pass it to the <code class="docutils literal notranslate"><span class="pre">by</span></code> argument in <code class="docutils literal notranslate"><span class="pre">topk</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">top_spenders</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="n">o_custkey</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="n">total_spend</span><span class="p">)</span>
<span class="n">orders</span><span class="p">[</span><span class="n">top_spenders</span><span class="p">]</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;o_orderstatus&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_12_0.png" src="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_12_0.png" />
</div>
</div>
</div>
<div class="section" id="Self-joins">
<h2>Self joins<a class="headerlink" href="#Self-joins" title="Permalink to this headline">¶</a></h2>
<p>If you’re a relational data guru, you may have wondered how it’s possible to join tables with themselves, because joins clauses involve column references back to the original table.</p>
<p>Consider the SQL</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">t1</span><span class="p">.</span><span class="k">key</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">t2</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="k">AS</span> <span class="n">metric</span>
<span class="k">FROM</span> <span class="n">my_table</span> <span class="n">t1</span>
  <span class="k">JOIN</span> <span class="n">my_table</span> <span class="n">t2</span>
    <span class="k">ON</span> <span class="n">t1</span><span class="p">.</span><span class="k">key</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">subkey</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Here, we have an unambiguous way to refer to each of the tables through aliasing.</p>
<p>Let’s consider the TPC-H database, and support we want to compute year-over-year change in total order amounts by region using joins.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">region</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_region&#39;</span><span class="p">)</span>
<span class="n">nation</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_nation&#39;</span><span class="p">)</span>
<span class="n">customer</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_customer&#39;</span><span class="p">)</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_orders&#39;</span><span class="p">)</span>

<span class="n">orders</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_15_0.png" src="../../_images/notebooks_tutorial_6-Advanced-Topics-TopK-SelfJoins_15_0.png" />
</div>
</div>
<p>First, let’s join all the things and select the fields we care about:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fields_of_interest</span> <span class="o">=</span> <span class="p">[</span><span class="n">region</span><span class="o">.</span><span class="n">r_name</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">),</span>
                      <span class="n">nation</span><span class="o">.</span><span class="n">n_name</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;nation&#39;</span><span class="p">),</span>
                      <span class="n">orders</span><span class="o">.</span><span class="n">o_totalprice</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">),</span>
                      <span class="n">orders</span><span class="o">.</span><span class="n">o_orderdate</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;odate&#39;</span><span class="p">)</span> <span class="c1"># these are strings</span>
                      <span class="p">]</span>

<span class="n">joined_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nation</span><span class="p">,</span> <span class="n">region</span><span class="o">.</span><span class="n">r_regionkey</span> <span class="o">==</span> <span class="n">nation</span><span class="o">.</span><span class="n">n_regionkey</span><span class="p">)</span>
              <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">customer</span><span class="p">,</span> <span class="n">customer</span><span class="o">.</span><span class="n">c_nationkey</span> <span class="o">==</span> <span class="n">nation</span><span class="o">.</span><span class="n">n_nationkey</span><span class="p">)</span>
              <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="n">orders</span><span class="o">.</span><span class="n">o_custkey</span> <span class="o">==</span> <span class="n">customer</span><span class="o">.</span><span class="n">c_custkey</span><span class="p">)</span>
              <span class="p">[</span><span class="n">fields_of_interest</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Okay, great, let’s have a look:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">joined_all</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>        region        nation     amount      odate
0  MIDDLE EAST        JORDAN  173665.47 1996-01-02
1  MIDDLE EAST          IRAN   46929.18 1996-12-01
2       AFRICA       MOROCCO  193846.25 1993-10-14
3  MIDDLE EAST          IRAN   32151.78 1995-10-11
4  MIDDLE EAST  SAUDI ARABIA  144659.20 1994-07-30
</pre></div>
</div>
</div>
<p>Sweet, now let’s aggregate by year and region:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">year</span> <span class="o">=</span> <span class="n">joined_all</span><span class="o">.</span><span class="n">odate</span><span class="o">.</span><span class="n">year</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>

<span class="n">total</span> <span class="o">=</span> <span class="n">joined_all</span><span class="o">.</span><span class="n">amount</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;double&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span>

<span class="n">annual_amounts</span> <span class="o">=</span> <span class="p">(</span><span class="n">joined_all</span>
                  <span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="n">year</span><span class="p">])</span>
                  <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">total</span><span class="p">))</span>
<span class="n">annual_amounts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>         region  year         total
0        EUROPE  1994  6.979473e+09
1        EUROPE  1996  7.015421e+09
2          ASIA  1997  6.910663e+09
3          ASIA  1998  4.058824e+09
4        EUROPE  1992  6.926705e+09
5       AMERICA  1995  6.905139e+09
6       AMERICA  1992  6.834349e+09
7        EUROPE  1998  4.113448e+09
8       AMERICA  1996  6.883057e+09
9        AFRICA  1993  6.859733e+09
10  MIDDLE EAST  1998  4.025011e+09
11  MIDDLE EAST  1997  6.814699e+09
12  MIDDLE EAST  1996  6.877095e+09
13         ASIA  1994  6.957170e+09
14         ASIA  1993  6.864540e+09
15       AFRICA  1997  6.848983e+09
16  MIDDLE EAST  1992  6.761499e+09
17  MIDDLE EAST  1993  6.797943e+09
18  MIDDLE EAST  1994  6.778384e+09
19  MIDDLE EAST  1995  6.830827e+09
20       AFRICA  1995  6.908429e+09
21         ASIA  1992  6.934801e+09
22      AMERICA  1998  3.991377e+09
23      AMERICA  1997  6.922465e+09
24       EUROPE  1993  6.911395e+09
25       EUROPE  1997  6.876824e+09
26       EUROPE  1995  6.970001e+09
27         ASIA  1995  6.931738e+09
28       AFRICA  1994  6.837587e+09
29       AFRICA  1996  6.878112e+09
30      AMERICA  1994  6.863756e+09
31       AFRICA  1992  6.873319e+09
32       AFRICA  1998  4.024061e+09
33      AMERICA  1993  6.906800e+09
34         ASIA  1996  6.955679e+09
</pre></div>
</div>
</div>
<p>Looking good so far. Now, we need to join this table on itself, by subtracting 1 from one of the year columns.</p>
<p>We do this by creating a “joinable” view of a table that is considered a distinct object within Ibis. To do this, use the <code class="docutils literal notranslate"><span class="pre">view</span></code> function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">current</span> <span class="o">=</span> <span class="n">annual_amounts</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">annual_amounts</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>

<span class="n">yoy_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">prior</span><span class="o">.</span><span class="n">total</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;yoy_change&#39;</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">((</span><span class="n">current</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="n">prior</span><span class="o">.</span><span class="n">region</span><span class="p">)</span> <span class="o">&amp;</span>
                                <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="p">(</span><span class="n">prior</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))))</span>
           <span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">yoy_change</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;yoy_pretty&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">yoy_change</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;$</span><span class="si">%.2f</span><span class="s1">mm&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="mf">1000000.</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>region</th>
      <th>year</th>
      <th>yoy_change</th>
      <th>yoy_pretty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AFRICA</td>
      <td>1994</td>
      <td>-7.084172e+07</td>
      <td>$-70.84mm</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AMERICA</td>
      <td>1996</td>
      <td>-3.940791e+07</td>
      <td>$-39.41mm</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AFRICA</td>
      <td>1996</td>
      <td>2.912979e+07</td>
      <td>$29.13mm</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AFRICA</td>
      <td>1992</td>
      <td>1.358699e+07</td>
      <td>$13.59mm</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ASIA</td>
      <td>1997</td>
      <td>2.851839e+09</td>
      <td>$2851.84mm</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ASIA</td>
      <td>1993</td>
      <td>-9.262979e+07</td>
      <td>$-92.63mm</td>
    </tr>
    <tr>
      <th>6</th>
      <td>EUROPE</td>
      <td>1993</td>
      <td>-6.807773e+07</td>
      <td>$-68.08mm</td>
    </tr>
    <tr>
      <th>7</th>
      <td>MIDDLE EAST</td>
      <td>1995</td>
      <td>-4.626817e+07</td>
      <td>$-46.27mm</td>
    </tr>
    <tr>
      <th>8</th>
      <td>MIDDLE EAST</td>
      <td>1994</td>
      <td>-5.244317e+07</td>
      <td>$-52.44mm</td>
    </tr>
    <tr>
      <th>9</th>
      <td>MIDDLE EAST</td>
      <td>1993</td>
      <td>1.955937e+07</td>
      <td>$19.56mm</td>
    </tr>
    <tr>
      <th>10</th>
      <td>MIDDLE EAST</td>
      <td>1992</td>
      <td>-3.644384e+07</td>
      <td>$-36.44mm</td>
    </tr>
    <tr>
      <th>11</th>
      <td>EUROPE</td>
      <td>1997</td>
      <td>2.763376e+09</td>
      <td>$2763.38mm</td>
    </tr>
    <tr>
      <th>12</th>
      <td>AMERICA</td>
      <td>1992</td>
      <td>-7.245078e+07</td>
      <td>$-72.45mm</td>
    </tr>
    <tr>
      <th>13</th>
      <td>AMERICA</td>
      <td>1995</td>
      <td>2.208216e+07</td>
      <td>$22.08mm</td>
    </tr>
    <tr>
      <th>14</th>
      <td>EUROPE</td>
      <td>1995</td>
      <td>-4.542062e+07</td>
      <td>$-45.42mm</td>
    </tr>
    <tr>
      <th>15</th>
      <td>ASIA</td>
      <td>1994</td>
      <td>2.543198e+07</td>
      <td>$25.43mm</td>
    </tr>
    <tr>
      <th>16</th>
      <td>MIDDLE EAST</td>
      <td>1996</td>
      <td>6.239623e+07</td>
      <td>$62.40mm</td>
    </tr>
    <tr>
      <th>17</th>
      <td>MIDDLE EAST</td>
      <td>1997</td>
      <td>2.789688e+09</td>
      <td>$2789.69mm</td>
    </tr>
    <tr>
      <th>18</th>
      <td>AFRICA</td>
      <td>1993</td>
      <td>2.214559e+07</td>
      <td>$22.15mm</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ASIA</td>
      <td>1995</td>
      <td>-2.394126e+07</td>
      <td>$-23.94mm</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ASIA</td>
      <td>1992</td>
      <td>7.026156e+07</td>
      <td>$70.26mm</td>
    </tr>
    <tr>
      <th>21</th>
      <td>AFRICA</td>
      <td>1997</td>
      <td>2.824921e+09</td>
      <td>$2824.92mm</td>
    </tr>
    <tr>
      <th>22</th>
      <td>AMERICA</td>
      <td>1993</td>
      <td>4.304359e+07</td>
      <td>$43.04mm</td>
    </tr>
    <tr>
      <th>23</th>
      <td>AMERICA</td>
      <td>1994</td>
      <td>-4.138320e+07</td>
      <td>$-41.38mm</td>
    </tr>
    <tr>
      <th>24</th>
      <td>AFRICA</td>
      <td>1995</td>
      <td>3.031631e+07</td>
      <td>$30.32mm</td>
    </tr>
    <tr>
      <th>25</th>
      <td>AMERICA</td>
      <td>1997</td>
      <td>2.931088e+09</td>
      <td>$2931.09mm</td>
    </tr>
    <tr>
      <th>26</th>
      <td>EUROPE</td>
      <td>1994</td>
      <td>9.471985e+06</td>
      <td>$9.47mm</td>
    </tr>
    <tr>
      <th>27</th>
      <td>EUROPE</td>
      <td>1996</td>
      <td>1.385975e+08</td>
      <td>$138.60mm</td>
    </tr>
    <tr>
      <th>28</th>
      <td>ASIA</td>
      <td>1996</td>
      <td>4.501570e+07</td>
      <td>$45.02mm</td>
    </tr>
    <tr>
      <th>29</th>
      <td>EUROPE</td>
      <td>1992</td>
      <td>1.531005e+07</td>
      <td>$15.31mm</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If you’re being fastidious and want to consider the first year occurring in the dataset for each region to have 0 for the prior year, you will instead need to do an outer join and treat nulls in the prior side of the join as zero:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">yoy_change</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">total</span> <span class="o">-</span> <span class="n">prior</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">zeroifnull</span><span class="p">())</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;yoy_change&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">outer_join</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">((</span><span class="n">current</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="n">prior</span><span class="o">.</span><span class="n">region</span><span class="p">)</span> <span class="o">&amp;</span>
                                      <span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="p">(</span><span class="n">prior</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))))</span>
           <span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">region</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
            <span class="n">prior</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">zeroifnull</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;prior_total&#39;</span><span class="p">),</span>
            <span class="n">yoy_change</span><span class="p">])</span>

<span class="n">results</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>        region  year         total   prior_total    yoy_change
0         ASIA  1998  4.058824e+09  0.000000e+00  4.058824e+09
1       AFRICA  1994  6.837587e+09  6.908429e+09 -7.084172e+07
2      AMERICA  1996  6.883057e+09  6.922465e+09 -3.940791e+07
3       AFRICA  1996  6.878112e+09  6.848983e+09  2.912979e+07
4       AFRICA  1992  6.873319e+09  6.859733e+09  1.358699e+07
5       AFRICA  1998  4.024061e+09  0.000000e+00  4.024061e+09
6         ASIA  1997  6.910663e+09  4.058824e+09  2.851839e+09
7         ASIA  1993  6.864540e+09  6.957170e+09 -9.262979e+07
8       EUROPE  1993  6.911395e+09  6.979473e+09 -6.807773e+07
9  MIDDLE EAST  1995  6.830827e+09  6.877095e+09 -4.626817e+07
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="7-Advanced-Topics-ComplexFiltering.html" class="btn btn-neutral float-right" title="Advanced Topics: Additional Filtering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="5-IO-Create-Insert-External-Data.html" class="btn btn-neutral float-left" title="IO, CREATE/INSERT, and External Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Ibis Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65303298-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using Ibis with Impala &mdash; Ibis 1.3.0+84.g0693518 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ibis.impala.api.ImpalaClient.database" href="../../generated/ibis.impala.api.ImpalaClient.database.html" />
    <link rel="prev" title="Configuring Ibis" href="../configuration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Ibis
          

          
            
            <img src="../../_static/logo-wide.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.3.0+84.g0693518
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Installation and Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../configuration.html">Configuring Ibis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using Ibis with Impala</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-impala-client-object">The Impala client object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#database-and-table-objects">Database and Table objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.database.html">ibis.impala.api.ImpalaClient.database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.table.html">ibis.impala.api.ImpalaClient.table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.schema.html">ibis.impala.api.ImpalaTable.schema</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#expression-execution">Expression execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-tables">Creating tables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.create_table.html">ibis.impala.api.ImpalaClient.create_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaDatabase.create_table.html">ibis.impala.api.ImpalaDatabase.create_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-tables-from-a-table-expression">Creating tables from a table expression</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-an-empty-table">Creating an empty table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-partitioned-table">Creating a partitioned table</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#partitioned-tables">Partitioned tables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.add_partition.html">ibis.impala.api.ImpalaTable.add_partition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.drop_partition.html">ibis.impala.api.ImpalaTable.drop_partition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.is_partitioned.html">ibis.impala.api.ImpalaTable.is_partitioned</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.partition_schema.html">ibis.impala.api.ImpalaTable.partition_schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.partitions.html">ibis.impala.api.ImpalaTable.partitions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#inserting-data-into-tables">Inserting data into tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-table-metadata">Managing table metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#detailed-table-metadata-describe-formatted">Detailed table metadata: <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">FORMATTED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-table-metadata">Modifying table metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#table-statistics">Table statistics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#computing-table-and-partition-statistics">Computing table and partition statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#seeing-table-and-column-statistics">Seeing table and column statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#refresh-and-invalidate-metadata"><code class="docutils literal notranslate"><span class="pre">REFRESH</span></code> and <code class="docutils literal notranslate"><span class="pre">INVALIDATE</span> <span class="pre">METADATA</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#issuing-load-data-commands">Issuing <code class="docutils literal notranslate"><span class="pre">LOAD</span> <span class="pre">DATA</span></code> commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.load_data.html">ibis.impala.api.ImpalaClient.load_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.load_data.html">ibis.impala.api.ImpalaTable.load_data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#parquet-and-other-session-options">Parquet and other session options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.disable_codegen.html">ibis.impala.api.ImpalaClient.disable_codegen</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.get_options.html">ibis.impala.api.ImpalaClient.get_options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.set_options.html">ibis.impala.api.ImpalaClient.set_options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.set_compression_codec.html">ibis.impala.api.ImpalaClient.set_compression_codec</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ingesting-data-from-pandas">Ingesting data from pandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-impala-udfs-in-ibis">Using Impala UDFs in Ibis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-scalar-functions-udfs">Using scalar functions (UDFs)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-documentation-to-new-functions">Adding documentation to new functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bigquery.html">Using Ibis with BigQuery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql.html">Ibis for SQL Programmers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../udf.html">User Defined Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending.html">Extending Ibis</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html">Backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../geospatial_analysis.html">Ibis and Geospatial Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending_elementwise_expr.html">Extending Ibis Part 1: Adding a New Elementwise Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../extending_reduce_expr.html">Extending Ibis Part 2: Adding a New Reduction Expression</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Ibis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User guide</a> &raquo;</li>
        
      <li>Using Ibis with Impala</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/user_guide/backends/impala.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="using-ibis-with-impala">
<span id="impala"></span><h1>Using Ibis with Impala<a class="headerlink" href="#using-ibis-with-impala" title="Permalink to this headline">¶</a></h1>
<p>One goal of Ibis is to provide an integrated Python API for an Impala cluster
without requiring you to switch back and forth between Python code and the
Impala shell (where one would be using a mix of DDL and SQL statements).</p>
<p>If you find an Impala task that you cannot perform with Ibis, please get in
touch on the <a class="reference external" href="http://github.com/pandas-dev/ibis">GitHub issue tracker</a>.</p>
<p>While interoperability between the Hadoop / Spark ecosystems and pandas / the
PyData stack is overall poor (but improving), we also show some ways that you
can use pandas with Ibis and Impala.</p>
<div class="section" id="the-impala-client-object">
<h2>The Impala client object<a class="headerlink" href="#the-impala-client-object" title="Permalink to this headline">¶</a></h2>
<p>To use Ibis with Impala, you first must connect to a cluster using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">ibis.impala.connect()</span></code> function, optionally supplying an HDFS
connection:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ibis</span>

<span class="n">hdfs</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">hdfs_connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">webhdfs_host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">webhdfs_port</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">impala</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">host</span><span class="o">=</span><span class="n">impala_host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">impala_port</span><span class="p">,</span> <span class="n">hdfs_client</span><span class="o">=</span><span class="n">hdfs</span>
<span class="p">)</span>
</pre></div>
</div>
<p>All IPython examples here use the following block of code to connect to impala
using docker:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">ibis</span>

<span class="gp">In [2]: </span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;impala&#39;</span>

<span class="gp">In [3]: </span><span class="n">hdfs</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">hdfs_connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">)</span>

<span class="gp">In [4]: </span><span class="n">client</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">impala</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">hdfs_client</span><span class="o">=</span><span class="n">hdfs</span><span class="p">)</span>
</pre></div>
</div>
<p>You can accomplish many tasks directly through the client object, but we
additionally provide APIs to streamline tasks involving a single Impala table
or database.</p>
</div>
<div class="section" id="database-and-table-objects">
<h2>Database and Table objects<a class="headerlink" href="#database-and-table-objects" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.database.html#ibis.impala.api.ImpalaClient.database" title="ibis.impala.api.ImpalaClient.database"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.database</span></code></a>([name])</p></td>
<td><p>Create a database object.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.table.html#ibis.impala.api.ImpalaClient.table" title="ibis.impala.api.ImpalaClient.table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.table</span></code></a>(name[, database])</p></td>
<td><p>Create a table expression.</p></td>
</tr>
</tbody>
</table>
<p>The client’s <code class="docutils literal notranslate"><span class="pre">table</span></code> method allows you to create an Ibis table expression
referencing a physical Impala table:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">table</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;functional_alltypes&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;ibis_testing&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>While you can get by fine with only table and client objects, Ibis has a notion
of a database object that simplifies interactions with a single Impala
database. It also gives you IPython tab completion of table names (that are
valid Python variable names):</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">database</span><span class="p">(</span><span class="s1">&#39;ibis_testing&#39;</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">db</span>
<span class="gh">Out[7]: </span><span class="go">ImpalaDatabase(&#39;ibis_testing&#39;)</span>

<span class="gp">In [8]: </span><span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">functional_alltypes</span>

<span class="gp">In [9]: </span><span class="n">db</span><span class="o">.</span><span class="n">list_tables</span><span class="p">()</span>
<span class="gh">Out[9]: </span><span class="go"></span>
<span class="go">[&#39;alltypes&#39;,</span>
<span class="go"> &#39;functional_alltypes&#39;,</span>
<span class="go"> &#39;tpch_customer&#39;,</span>
<span class="go"> &#39;tpch_lineitem&#39;,</span>
<span class="go"> &#39;tpch_nation&#39;,</span>
<span class="go"> &#39;tpch_orders&#39;,</span>
<span class="go"> &#39;tpch_part&#39;,</span>
<span class="go"> &#39;tpch_partsupp&#39;,</span>
<span class="go"> &#39;tpch_region&#39;,</span>
<span class="go"> &#39;tpch_region_avro&#39;,</span>
<span class="go"> &#39;tpch_supplier&#39;]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ImpalaTable</span></code> is a Python subclass of the more general Ibis <code class="docutils literal notranslate"><span class="pre">TableExpr</span></code>
that has additional Impala-specific methods. So you can use it interchangeably
with any code expecting a <code class="docutils literal notranslate"><span class="pre">TableExpr</span></code>.</p>
<p>Like all table expressions in Ibis, <code class="docutils literal notranslate"><span class="pre">ImpalaTable</span></code> has a <code class="docutils literal notranslate"><span class="pre">schema</span></code> method you
can use to examine its schema:</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.schema.html#ibis.impala.api.ImpalaTable.schema" title="ibis.impala.api.ImpalaTable.schema"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.schema</span></code></a>()</p></td>
<td><p>Get the schema for this table (if one is known)</p></td>
</tr>
</tbody>
</table>
<p>While the client has a <code class="docutils literal notranslate"><span class="pre">drop_table</span></code> method you can use to drop tables, the
table itself has a method <code class="docutils literal notranslate"><span class="pre">drop</span></code> that you can use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="expression-execution">
<h2>Expression execution<a class="headerlink" href="#expression-execution" title="Permalink to this headline">¶</a></h2>
<p>Ibis expressions have an <code class="docutils literal notranslate"><span class="pre">execute</span></code> method with compiles and runs the
expressions on Impala or whichever backend is being referenced.</p>
<p>For example:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">fa</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">functional_alltypes</span>

<span class="gp">In [11]: </span><span class="n">expr</span> <span class="o">=</span> <span class="n">fa</span><span class="o">.</span><span class="n">double_col</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="gp">In [12]: </span><span class="n">expr</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gh">Out[12]: </span><span class="go">331785.00000000006</span>
</pre></div>
</div>
<p>For longer-running queries, Ibis will attempt to cancel the query in progress
if an interrupt is received.</p>
</div>
<div class="section" id="creating-tables">
<h2>Creating tables<a class="headerlink" href="#creating-tables" title="Permalink to this headline">¶</a></h2>
<p>There are several ways to create new Impala tables:</p>
<ul class="simple">
<li><p>From an Ibis table expression</p></li>
<li><p>Empty, from a declared schema</p></li>
<li><p>Empty and partitioned</p></li>
</ul>
<p>In all cases, you should use the <code class="docutils literal notranslate"><span class="pre">create_table</span></code> method either on the
top-level client connection or a database object.</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.create_table.html#ibis.impala.api.ImpalaClient.create_table" title="ibis.impala.api.ImpalaClient.create_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.create_table</span></code></a>(table_name[, obj, …])</p></td>
<td><p>Create a new table in Impala using an Ibis table expression.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaDatabase.create_table.html#ibis.impala.api.ImpalaDatabase.create_table" title="ibis.impala.api.ImpalaDatabase.create_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaDatabase.create_table</span></code></a>(table_name[, obj])</p></td>
<td><p>Dispatch to ImpalaClient.create_table.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="creating-tables-from-a-table-expression">
<h3>Creating tables from a table expression<a class="headerlink" href="#creating-tables-from-a-table-expression" title="Permalink to this headline">¶</a></h3>
<p>If you pass an Ibis expression to <code class="docutils literal notranslate"><span class="pre">create_table</span></code>, Ibis issues a <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span> <span class="pre">..</span> <span class="pre">AS</span> <span class="pre">SELECT</span></code> (CTAS) statement:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;functional_alltypes&#39;</span><span class="p">)</span>

<span class="gp">In [14]: </span><span class="n">expr</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s1">&#39;string_col&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

<span class="gp">In [15]: </span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;string_freqs&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;parquet&#39;</span><span class="p">)</span>

<span class="gp">In [16]: </span><span class="n">freqs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;string_freqs&#39;</span><span class="p">)</span>

<span class="gp">In [17]: </span><span class="n">freqs</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gh">Out[17]: </span><span class="go"></span>
<span class="go">  string_col  count</span>
<span class="go">0          9    730</span>
<span class="go">1          3    730</span>
<span class="go">2          6    730</span>
<span class="go">3          4    730</span>
<span class="go">4          1    730</span>
<span class="go">5          8    730</span>
<span class="go">6          2    730</span>
<span class="go">7          7    730</span>
<span class="go">8          5    730</span>
<span class="go">9          0    730</span>

<span class="gp">In [18]: </span><span class="n">files</span> <span class="o">=</span> <span class="n">freqs</span><span class="o">.</span><span class="n">files</span><span class="p">()</span>

<span class="gp">In [19]: </span><span class="n">files</span>
<span class="gh">Out[19]: </span><span class="go"></span>
<span class="go">                                                Path  Size Partition</span>
<span class="go">0  hdfs://impala:8020/user/hive/warehouse/ibis_te...  584B          </span>

<span class="gp">In [20]: </span><span class="n">freqs</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also choose to create an empty table and use <code class="docutils literal notranslate"><span class="pre">insert</span></code> (see below).</p>
</div>
<div class="section" id="creating-an-empty-table">
<h3>Creating an empty table<a class="headerlink" href="#creating-an-empty-table" title="Permalink to this headline">¶</a></h3>
<p>To create an empty table, you must declare an Ibis schema that will be
translated to the appopriate Impala schema and data types.</p>
<p>As Ibis types are simplified compared with Impala types, this may expand in the
future to include a more fine-grained schema declaration.</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">create_table</span></code> method either on a database or client object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">schema</span><span class="p">([(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">)])</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;new_table&#39;</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, this stores the data files in the database default location. You
can force a particular path with the <code class="docutils literal notranslate"><span class="pre">location</span></code> option.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getuser</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">schema</span><span class="p">([(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">)])</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;new_table&#39;</span>
<span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;/home/</span><span class="si">{}</span><span class="s1">/new-table-data&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getuser</span><span class="p">())</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
</pre></div>
</div>
<p>If the schema matches a known table schema, you can always use the <code class="docutils literal notranslate"><span class="pre">schema</span></code>
method to get a schema object:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;functional_alltypes&#39;</span><span class="p">)</span>

<span class="gp">In [22]: </span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="p">()</span>
<span class="gh">Out[22]: </span><span class="go"></span>
<span class="go">ibis.Schema {  </span>
<span class="go">  id               int32</span>
<span class="go">  bool_col         boolean</span>
<span class="go">  tinyint_col      int8</span>
<span class="go">  smallint_col     int16</span>
<span class="go">  int_col          int32</span>
<span class="go">  bigint_col       int64</span>
<span class="go">  float_col        float32</span>
<span class="go">  double_col       float64</span>
<span class="go">  date_string_col  string</span>
<span class="go">  string_col       string</span>
<span class="go">  timestamp_col    timestamp</span>
<span class="go">  year             int32</span>
<span class="go">  month            int32</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-partitioned-table">
<h3>Creating a partitioned table<a class="headerlink" href="#creating-a-partitioned-table" title="Permalink to this headline">¶</a></h3>
<p>To create an empty partitioned table, include a list of columns to be used as
the partition keys.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">schema</span><span class="p">([(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">)])</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;new_table&#39;</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">partition</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="partitioned-tables">
<h2>Partitioned tables<a class="headerlink" href="#partitioned-tables" title="Permalink to this headline">¶</a></h2>
<p>Ibis enables you to manage partitioned tables in various ways. Since each
partition behaves as its own “subtable” sharing a common schema, each partition
can have its own file format, directory path, serialization properties, and so
forth.</p>
<p>There are a handful of table methods for adding and removing partitions and
getting information about the partition schema and any existing partition data:</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.add_partition.html#ibis.impala.api.ImpalaTable.add_partition" title="ibis.impala.api.ImpalaTable.add_partition"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.add_partition</span></code></a>(spec[, location])</p></td>
<td><p>Add a new table partition, creating any new directories in HDFS if necessary.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.drop_partition.html#ibis.impala.api.ImpalaTable.drop_partition" title="ibis.impala.api.ImpalaTable.drop_partition"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.drop_partition</span></code></a>(spec)</p></td>
<td><p>Drop an existing table partition</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.is_partitioned.html#ibis.impala.api.ImpalaTable.is_partitioned" title="ibis.impala.api.ImpalaTable.is_partitioned"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.is_partitioned</span></code></a></p></td>
<td><p>True if the table is partitioned</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.partition_schema.html#ibis.impala.api.ImpalaTable.partition_schema" title="ibis.impala.api.ImpalaTable.partition_schema"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.partition_schema</span></code></a>()</p></td>
<td><p>For partitioned tables, return the schema (names and types) for the partition columns</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.partitions.html#ibis.impala.api.ImpalaTable.partitions" title="ibis.impala.api.ImpalaTable.partitions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.partitions</span></code></a>()</p></td>
<td><p>Return a pandas.DataFrame giving information about this table’s partitions.</p></td>
</tr>
</tbody>
</table>
<p>To address a specific partition in any method that is partition specific, you
can either use a dict with the partition key names and values, or pass a list
of the partition values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">schema</span><span class="p">([(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;int32&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;int16&#39;</span><span class="p">)])</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;new_table&#39;</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">partition</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">])</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">add_partition</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2007</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">})</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_partition</span><span class="p">([</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_partition</span><span class="p">([</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="n">table</span><span class="o">.</span><span class="n">drop_partition</span><span class="p">([</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
</pre></div>
</div>
<p>We’ll cover partition metadata management and data loading below.</p>
</div>
<div class="section" id="inserting-data-into-tables">
<h2>Inserting data into tables<a class="headerlink" href="#inserting-data-into-tables" title="Permalink to this headline">¶</a></h2>
<p>If the schemas are compatible, you can insert into a table directly from an
Ibis table expression:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">functional_alltypes</span>

<span class="gp">In [24]: </span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;insert_test&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="p">())</span>

<span class="gp">In [25]: </span><span class="n">target</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;insert_test&#39;</span><span class="p">)</span>

<span class="gp">In [26]: </span><span class="n">target</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>

<span class="gp">In [27]: </span><span class="n">target</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>

<span class="gp">In [28]: </span><span class="n">target</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>

<span class="gp">In [29]: </span><span class="n">target</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gh">Out[29]: </span><span class="go"></span>
<span class="go">     id  bool_col  tinyint_col  ...           timestamp_col  year  month</span>
<span class="go">0  5770      True            0  ... 2010-08-01 00:00:00.000  2010      8</span>
<span class="go">1  5771     False            1  ... 2010-08-01 00:01:00.000  2010      8</span>
<span class="go">2  5772      True            2  ... 2010-08-01 00:02:00.100  2010      8</span>
<span class="go">3  5770      True            0  ... 2010-08-01 00:00:00.000  2010      8</span>
<span class="go">4  5771     False            1  ... 2010-08-01 00:01:00.000  2010      8</span>
<span class="go">5  5772      True            2  ... 2010-08-01 00:02:00.100  2010      8</span>
<span class="go">6  5770      True            0  ... 2010-08-01 00:00:00.000  2010      8</span>
<span class="go">7  5771     False            1  ... 2010-08-01 00:01:00.000  2010      8</span>
<span class="go">8  5772      True            2  ... 2010-08-01 00:02:00.100  2010      8</span>

<span class="go">[9 rows x 13 columns]</span>

<span class="gp">In [30]: </span><span class="n">target</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
<p>If the table is partitioned, you must indicate the partition you are inserting
into:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">part</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2007</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">partition</span><span class="o">=</span><span class="n">part</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="managing-table-metadata">
<h2>Managing table metadata<a class="headerlink" href="#managing-table-metadata" title="Permalink to this headline">¶</a></h2>
<p>Ibis has functions that wrap many of the DDL commands for Impala table metadata.</p>
<div class="section" id="detailed-table-metadata-describe-formatted">
<h3>Detailed table metadata: <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">FORMATTED</span></code><a class="headerlink" href="#detailed-table-metadata-describe-formatted" title="Permalink to this headline">¶</a></h3>
<p>To get a handy wrangled version of <code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">FORMATTED</span></code> use the <code class="docutils literal notranslate"><span class="pre">metadata</span></code>
method.</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.metadata.html#ibis.impala.api.ImpalaTable.metadata" title="ibis.impala.api.ImpalaTable.metadata"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.metadata</span></code></a>()</p></td>
<td><p>Return parsed results of DESCRIBE FORMATTED statement</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">TableMetadata</span></code> object that is returned has a nicer console output and
many attributes set that you can explore in IPython:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [31]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;ibis_testing.functional_alltypes&#39;</span><span class="p">)</span>

<span class="gp">In [32]: </span><span class="n">meta</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">metadata</span><span class="p">()</span>

<span class="gp">In [33]: </span><span class="n">meta</span>
<span class="gh">Out[33]: </span><span class="go"></span>
<span class="go">&lt;class &#39;ibis.impala.metadata.TableMetadata&#39;&gt;</span>
<span class="go">{&#39;info&#39;: {&#39;CreateTime&#39;: datetime.datetime(2020, 7, 21, 12, 39, 21),</span>
<span class="go">          &#39;Database&#39;: &#39;ibis_testing&#39;,</span>
<span class="go">          &#39;LastAccessTime&#39;: &#39;UNKNOWN&#39;,</span>
<span class="go">          &#39;Location&#39;: &#39;hdfs://impala:8020/__ibis/ibis-testing-data/parquet/functional_alltypes&#39;,</span>
<span class="go">          &#39;Owner&#39;: &#39;root&#39;,</span>
<span class="go">          &#39;Protect Mode&#39;: &#39;None&#39;,</span>
<span class="go">          &#39;Retention&#39;: 0,</span>
<span class="go">          &#39;Table Parameters&#39;: {&#39;COLUMN_STATS_ACCURATE&#39;: False,</span>
<span class="go">                               &#39;EXTERNAL&#39;: True,</span>
<span class="go">                               &#39;STATS_GENERATED_VIA_STATS_TASK&#39;: True,</span>
<span class="go">                               &#39;numFiles&#39;: 3,</span>
<span class="go">                               &#39;numRows&#39;: 7300,</span>
<span class="go">                               &#39;rawDataSize&#39;: &#39;-1&#39;,</span>
<span class="go">                               &#39;totalSize&#39;: 106278,</span>
<span class="go">                               &#39;transient_lastDdlTime&#39;: datetime.datetime(2020, 7, 21, 12, 39, 29)},</span>
<span class="go">          &#39;Table Type&#39;: &#39;EXTERNAL_TABLE&#39;},</span>
<span class="go"> &#39;schema&#39;: [(&#39;id&#39;, &#39;int&#39;),</span>
<span class="go">            (&#39;bool_col&#39;, &#39;boolean&#39;),</span>
<span class="go">            (&#39;tinyint_col&#39;, &#39;tinyint&#39;),</span>
<span class="go">            (&#39;smallint_col&#39;, &#39;smallint&#39;),</span>
<span class="go">            (&#39;int_col&#39;, &#39;int&#39;),</span>
<span class="go">            (&#39;bigint_col&#39;, &#39;bigint&#39;),</span>
<span class="go">            (&#39;float_col&#39;, &#39;float&#39;),</span>
<span class="go">            (&#39;double_col&#39;, &#39;double&#39;),</span>
<span class="go">            (&#39;date_string_col&#39;, &#39;string&#39;),</span>
<span class="go">            (&#39;string_col&#39;, &#39;string&#39;),</span>
<span class="go">            (&#39;timestamp_col&#39;, &#39;timestamp&#39;),</span>
<span class="go">            (&#39;year&#39;, &#39;int&#39;),</span>
<span class="go">            (&#39;month&#39;, &#39;int&#39;)],</span>
<span class="go"> &#39;storage info&#39;: {&#39;Bucket Columns&#39;: &#39;[]&#39;,</span>
<span class="go">                  &#39;Compressed&#39;: False,</span>
<span class="go">                  &#39;InputFormat&#39;: &#39;org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat&#39;,</span>
<span class="go">                  &#39;Num Buckets&#39;: 0,</span>
<span class="go">                  &#39;OutputFormat&#39;: &#39;org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat&#39;,</span>
<span class="go">                  &#39;SerDe Library&#39;: &#39;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&#39;,</span>
<span class="go">                  &#39;Sort Columns&#39;: &#39;[]&#39;}}</span>

<span class="gp">In [34]: </span><span class="n">meta</span><span class="o">.</span><span class="n">location</span>
<span class="gh">Out[34]: </span><span class="go">&#39;hdfs://impala:8020/__ibis/ibis-testing-data/parquet/functional_alltypes&#39;</span>

<span class="gp">In [35]: </span><span class="n">meta</span><span class="o">.</span><span class="n">create_time</span>
<span class="gh">Out[35]: </span><span class="go">datetime.datetime(2020, 7, 21, 12, 39, 21)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">files</span></code> function is also available to see all of the physical HDFS data
files backing a table:</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.files.html#ibis.impala.api.ImpalaTable.files" title="ibis.impala.api.ImpalaTable.files"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.files</span></code></a>()</p></td>
<td><p>Return results of SHOW FILES statement</p></td>
</tr>
</tbody>
</table>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">ss</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpcds_parquet.store_sales&#39;</span><span class="p">)</span>

<span class="gp">In [10]: </span><span class="n">ss</span><span class="o">.</span><span class="n">files</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
<span class="gh">Out[10]:</span>
<span class="go">                                                path      size  \</span>
<span class="go">0  hdfs://localhost:20500/test-warehouse/tpcds.st...  160.61KB</span>
<span class="go">1  hdfs://localhost:20500/test-warehouse/tpcds.st...  123.88KB</span>
<span class="go">2  hdfs://localhost:20500/test-warehouse/tpcds.st...  139.28KB</span>
<span class="go">3  hdfs://localhost:20500/test-warehouse/tpcds.st...  139.60KB</span>
<span class="go">4  hdfs://localhost:20500/test-warehouse/tpcds.st...   62.84KB</span>

<span class="go">                 partition</span>
<span class="go">0  ss_sold_date_sk=2451803</span>
<span class="go">1  ss_sold_date_sk=2451819</span>
<span class="go">2  ss_sold_date_sk=2451772</span>
<span class="go">3  ss_sold_date_sk=2451789</span>
<span class="go">4  ss_sold_date_sk=2451741</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-table-metadata">
<h3>Modifying table metadata<a class="headerlink" href="#modifying-table-metadata" title="Permalink to this headline">¶</a></h3>
<p>For unpartitioned tables, you can use the <code class="docutils literal notranslate"><span class="pre">alter</span></code> method to change its
location, file format, and other properties. For partitioned tables, to change
partition-specific metadata use <code class="docutils literal notranslate"><span class="pre">alter_partition</span></code>.</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.alter.html#ibis.impala.api.ImpalaTable.alter" title="ibis.impala.api.ImpalaTable.alter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.alter</span></code></a>([location, format, …])</p></td>
<td><p>Change setting and parameters of the table.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.alter_partition.html#ibis.impala.api.ImpalaTable.alter_partition" title="ibis.impala.api.ImpalaTable.alter_partition"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.alter_partition</span></code></a>(spec[, …])</p></td>
<td><p>Change setting and parameters of an existing partition</p></td>
</tr>
</tbody>
</table>
<p>For example, if you wanted to “point” an existing table at a directory of CSV
files, you could run the following command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getuser</span>

<span class="n">csv_props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;serialization.format&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
    <span class="s1">&#39;field.delim&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="s1">&#39;/home/</span><span class="si">{}</span><span class="s1">/my-csv-files&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getuser</span><span class="p">())</span>

<span class="n">table</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">serde_properties</span><span class="o">=</span><span class="n">csv_props</span><span class="p">)</span>
</pre></div>
</div>
<p>If the table is partitioned, you can modify only the properties of a particular
partition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">alter_partition</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2007</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
    <span class="n">location</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span>
    <span class="n">serde_properties</span><span class="o">=</span><span class="n">csv_props</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="table-statistics">
<h2>Table statistics<a class="headerlink" href="#table-statistics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="computing-table-and-partition-statistics">
<h3>Computing table and partition statistics<a class="headerlink" href="#computing-table-and-partition-statistics" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.compute_stats.html#ibis.impala.api.ImpalaTable.compute_stats" title="ibis.impala.api.ImpalaTable.compute_stats"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.compute_stats</span></code></a>([incremental])</p></td>
<td><p>Invoke Impala COMPUTE STATS command to compute column, table, and partition statistics.</p></td>
</tr>
</tbody>
</table>
<p>Impala-backed physical tables have a method <code class="docutils literal notranslate"><span class="pre">compute_stats</span></code> that computes
table, column, and partition-level statistics to assist with query planning and
optimization. It is standard practice to invoke this after creating a table or
loading new data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">compute_stats</span><span class="p">()</span>
</pre></div>
</div>
<p>If you are using a recent version of Impala, you can also access the <code class="docutils literal notranslate"><span class="pre">COMPUTE</span>
<span class="pre">INCREMENTAL</span> <span class="pre">STATS</span></code> DDL command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">compute_stats</span><span class="p">(</span><span class="n">incremental</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="seeing-table-and-column-statistics">
<h3>Seeing table and column statistics<a class="headerlink" href="#seeing-table-and-column-statistics" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.column_stats.html#ibis.impala.api.ImpalaTable.column_stats" title="ibis.impala.api.ImpalaTable.column_stats"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.column_stats</span></code></a>()</p></td>
<td><p>Return results of SHOW COLUMN STATS as a pandas DataFrame</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.stats.html#ibis.impala.api.ImpalaTable.stats" title="ibis.impala.api.ImpalaTable.stats"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.stats</span></code></a>()</p></td>
<td><p>Return results of SHOW TABLE STATS as a DataFrame.</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">compute_stats</span></code> and <code class="docutils literal notranslate"><span class="pre">stats</span></code> functions return the results of <code class="docutils literal notranslate"><span class="pre">SHOW</span>
<span class="pre">COLUMN</span> <span class="pre">STATS</span></code> and <code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">TABLE</span> <span class="pre">STATS</span></code>, respectively, and their output will
depend, of course, on the last <code class="docutils literal notranslate"><span class="pre">COMPUTE</span> <span class="pre">STATS</span></code> call.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">ss</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpcds_parquet.store_sales&#39;</span><span class="p">)</span>

<span class="gp">In [6]: </span><span class="n">ss</span><span class="o">.</span><span class="n">compute_stats</span><span class="p">(</span><span class="n">incremental</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">stats</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">stats</span><span class="p">()</span>
<span class="go">s</span>
<span class="gp">In [8]: </span><span class="n">stats</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
<span class="gh">Out[8]:</span>
<span class="go">  ss_sold_date_sk  #Rows  #Files     Size Bytes Cached Cache Replication  \</span>
<span class="go">0         2450829   1071       1  78.34KB   NOT CACHED        NOT CACHED</span>
<span class="go">1         2450846    839       1  61.83KB   NOT CACHED        NOT CACHED</span>
<span class="go">2         2450860    747       1  54.86KB   NOT CACHED        NOT CACHED</span>
<span class="go">3         2450874    922       1  66.74KB   NOT CACHED        NOT CACHED</span>
<span class="go">4         2450888    856       1  63.33KB   NOT CACHED        NOT CACHED</span>

<span class="go">    Format Incremental stats  \</span>
<span class="go">0  PARQUET              true</span>
<span class="go">1  PARQUET              true</span>
<span class="go">2  PARQUET              true</span>
<span class="go">3  PARQUET              true</span>
<span class="go">4  PARQUET              true</span>

<span class="go">                                            Location</span>
<span class="go">0  hdfs://localhost:20500/test-warehouse/tpcds.st...</span>
<span class="go">1  hdfs://localhost:20500/test-warehouse/tpcds.st...</span>
<span class="go">2  hdfs://localhost:20500/test-warehouse/tpcds.st...</span>
<span class="go">3  hdfs://localhost:20500/test-warehouse/tpcds.st...</span>
<span class="go">4  hdfs://localhost:20500/test-warehouse/tpcds.st...</span>

<span class="gp">In [9]: </span><span class="n">cstats</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">column_stats</span><span class="p">()</span>

<span class="gp">In [10]: </span><span class="n">cstats</span>
<span class="gh">Out[10]:</span>
<span class="go">                   Column          Type  #Distinct Values  #Nulls  Max Size  Avg Size</span>
<span class="go">0         ss_sold_time_sk        BIGINT             13879      -1       NaN         8</span>
<span class="go">1              ss_item_sk        BIGINT             17925      -1       NaN         8</span>
<span class="go">2          ss_customer_sk        BIGINT             15207      -1       NaN         8</span>
<span class="go">3             ss_cdemo_sk        BIGINT             16968      -1       NaN         8</span>
<span class="go">4             ss_hdemo_sk        BIGINT              6220      -1       NaN         8</span>
<span class="go">5              ss_addr_sk        BIGINT             14077      -1       NaN         8</span>
<span class="go">6             ss_store_sk        BIGINT                 6      -1       NaN         8</span>
<span class="go">7             ss_promo_sk        BIGINT               298      -1       NaN         8</span>
<span class="go">8        ss_ticket_number           INT             15006      -1       NaN         4</span>
<span class="go">9             ss_quantity           INT                99      -1       NaN         4</span>
<span class="go">10      ss_wholesale_cost  DECIMAL(7,2)             10196      -1       NaN         4</span>
<span class="go">11          ss_list_price  DECIMAL(7,2)             19393      -1       NaN         4</span>
<span class="go">12         ss_sales_price  DECIMAL(7,2)             15594      -1       NaN         4</span>
<span class="go">13    ss_ext_discount_amt  DECIMAL(7,2)             29772      -1       NaN         4</span>
<span class="go">14     ss_ext_sales_price  DECIMAL(7,2)            102758      -1       NaN         4</span>
<span class="go">15  ss_ext_wholesale_cost  DECIMAL(7,2)            125448      -1       NaN         4</span>
<span class="go">16      ss_ext_list_price  DECIMAL(7,2)            141419      -1       NaN         4</span>
<span class="go">17             ss_ext_tax  DECIMAL(7,2)             33837      -1       NaN         4</span>
<span class="go">18          ss_coupon_amt  DECIMAL(7,2)             29772      -1       NaN         4</span>
<span class="go">19            ss_net_paid  DECIMAL(7,2)            109981      -1       NaN         4</span>
<span class="go">20    ss_net_paid_inc_tax  DECIMAL(7,2)            132286      -1       NaN         4</span>
<span class="go">21          ss_net_profit  DECIMAL(7,2)            122436      -1       NaN         4</span>
<span class="go">22        ss_sold_date_sk        BIGINT               120       0       NaN         8</span>
</pre></div>
</div>
</div>
<div class="section" id="refresh-and-invalidate-metadata">
<h3><code class="docutils literal notranslate"><span class="pre">REFRESH</span></code> and <code class="docutils literal notranslate"><span class="pre">INVALIDATE</span> <span class="pre">METADATA</span></code><a class="headerlink" href="#refresh-and-invalidate-metadata" title="Permalink to this headline">¶</a></h3>
<p>These DDL commands are available as table-level and client-level methods:</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.invalidate_metadata.html#ibis.impala.api.ImpalaClient.invalidate_metadata" title="ibis.impala.api.ImpalaClient.invalidate_metadata"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.invalidate_metadata</span></code></a>([name, …])</p></td>
<td><p>Issue INVALIDATE METADATA command, optionally only applying to a particular table.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.invalidate_metadata.html#ibis.impala.api.ImpalaTable.invalidate_metadata" title="ibis.impala.api.ImpalaTable.invalidate_metadata"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.invalidate_metadata</span></code></a>()</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.refresh.html#ibis.impala.api.ImpalaTable.refresh" title="ibis.impala.api.ImpalaTable.refresh"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.refresh</span></code></a>()</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p>You can invalidate the cached metadata for a single table or for all tables
using <code class="docutils literal notranslate"><span class="pre">invalidate_metadata</span></code>, and similarly invoke <code class="docutils literal notranslate"><span class="pre">REFRESH</span>
<span class="pre">db_name.table_name</span></code> using the <code class="docutils literal notranslate"><span class="pre">refresh</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">invalidate_metadata</span><span class="p">()</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">invalidate_metadata</span><span class="p">()</span>

<span class="n">table</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</pre></div>
</div>
<p>These methods are often used in conjunction with the <code class="docutils literal notranslate"><span class="pre">LOAD</span> <span class="pre">DATA</span></code> commands and
<code class="docutils literal notranslate"><span class="pre">COMPUTE</span> <span class="pre">STATS</span></code>. See the Impala documentation for full details.</p>
</div>
</div>
<div class="section" id="issuing-load-data-commands">
<h2>Issuing <code class="docutils literal notranslate"><span class="pre">LOAD</span> <span class="pre">DATA</span></code> commands<a class="headerlink" href="#issuing-load-data-commands" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">LOAD</span> <span class="pre">DATA</span></code> DDL physically moves a single data file or a directory of
files into the correct location for a table or table partition. It is
especially useful for partitioned tables as you do not have to construct the
directory path for a partition by hand, so simpler and less error-prone than
manually moving files with low level HDFS commands. It also deals with file
name conflicts so data is not lost in such cases.</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.load_data.html#ibis.impala.api.ImpalaClient.load_data" title="ibis.impala.api.ImpalaClient.load_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.load_data</span></code></a>(table_name, path[, …])</p></td>
<td><p>Wraps the LOAD DATA DDL statement.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaTable.load_data.html#ibis.impala.api.ImpalaTable.load_data" title="ibis.impala.api.ImpalaTable.load_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaTable.load_data</span></code></a>(path[, overwrite, …])</p></td>
<td><p>Wraps the LOAD DATA DDL statement.</p></td>
</tr>
</tbody>
</table>
<p>To use these methods, pass the path of a single file or a directory of files
you want to load. Afterward, you may want to update the table statistics (see
Impala documentation):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</pre></div>
</div>
<p>Like the other methods with support for partitioned tables, you can load into a
particular partition with the <code class="docutils literal notranslate"><span class="pre">partition</span></code> keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">part</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2007</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">table</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">partition</span><span class="o">=</span><span class="n">part</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parquet-and-other-session-options">
<h2>Parquet and other session options<a class="headerlink" href="#parquet-and-other-session-options" title="Permalink to this headline">¶</a></h2>
<p>Ibis gives you access to Impala session-level variables that affect query
execution:</p>
<table class="longtable docutils align-center">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.disable_codegen.html#ibis.impala.api.ImpalaClient.disable_codegen" title="ibis.impala.api.ImpalaClient.disable_codegen"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.disable_codegen</span></code></a>([disabled])</p></td>
<td><p>Turn off or on LLVM codegen in Impala query execution</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.get_options.html#ibis.impala.api.ImpalaClient.get_options" title="ibis.impala.api.ImpalaClient.get_options"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.get_options</span></code></a>()</p></td>
<td><p>Return current query options for the Impala session</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.set_options.html#ibis.impala.api.ImpalaClient.set_options" title="ibis.impala.api.ImpalaClient.set_options"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.set_options</span></code></a>(options)</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../../generated/ibis.impala.api.ImpalaClient.set_compression_codec.html#ibis.impala.api.ImpalaClient.set_compression_codec" title="ibis.impala.api.ImpalaClient.set_compression_codec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImpalaClient.set_compression_codec</span></code></a>(codec)</p></td>
<td><p>Parameters</p></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [36]: </span><span class="n">client</span><span class="o">.</span><span class="n">get_options</span><span class="p">()</span>
<span class="gh">Out[36]: </span><span class="go"></span>
<span class="go">{&#39;ABORT_ON_ERROR&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;APPX_COUNT_DISTINCT&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;BUFFER_POOL_LIMIT&#39;: &#39;&#39;,</span>
<span class="go"> &#39;COMPRESSION_CODEC&#39;: &#39;&#39;,</span>
<span class="go"> &#39;COMPUTE_STATS_MIN_SAMPLE_SIZE&#39;: &#39;1073741824&#39;,</span>
<span class="go"> &#39;DEFAULT_JOIN_DISTRIBUTION_MODE&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;DEFAULT_SPILLABLE_BUFFER_SIZE&#39;: &#39;2097152&#39;,</span>
<span class="go"> &#39;DISABLE_CODEGEN&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;DISABLE_CODEGEN_ROWS_THRESHOLD&#39;: &#39;50000&#39;,</span>
<span class="go"> &#39;DISABLE_ROW_RUNTIME_FILTERING&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;DISABLE_STREAMING_PREAGGREGATIONS&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;DISABLE_UNSAFE_SPILLS&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;ENABLE_EXPR_REWRITES&#39;: &#39;1&#39;,</span>
<span class="go"> &#39;EXEC_SINGLE_NODE_ROWS_THRESHOLD&#39;: &#39;100&#39;,</span>
<span class="go"> &#39;EXEC_TIME_LIMIT_S&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;EXPLAIN_LEVEL&#39;: &#39;1&#39;,</span>
<span class="go"> &#39;HBASE_CACHE_BLOCKS&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;HBASE_CACHING&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;IDLE_SESSION_TIMEOUT&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;MAX_ERRORS&#39;: &#39;100&#39;,</span>
<span class="go"> &#39;MAX_NUM_RUNTIME_FILTERS&#39;: &#39;10&#39;,</span>
<span class="go"> &#39;MAX_ROW_SIZE&#39;: &#39;524288&#39;,</span>
<span class="go"> &#39;MEM_LIMIT&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;MIN_SPILLABLE_BUFFER_SIZE&#39;: &#39;65536&#39;,</span>
<span class="go"> &#39;MT_DOP&#39;: &#39;&#39;,</span>
<span class="go"> &#39;NUM_SCANNER_THREADS&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;OPTIMIZE_PARTITION_KEY_SCANS&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;PARQUET_ANNOTATE_STRINGS_UTF8&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;PARQUET_ARRAY_RESOLUTION&#39;: &#39;2&#39;,</span>
<span class="go"> &#39;PARQUET_DICTIONARY_FILTERING&#39;: &#39;1&#39;,</span>
<span class="go"> &#39;PARQUET_FALLBACK_SCHEMA_RESOLUTION&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;PARQUET_FILE_SIZE&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;PARQUET_READ_STATISTICS&#39;: &#39;1&#39;,</span>
<span class="go"> &#39;PREFETCH_MODE&#39;: &#39;1&#39;,</span>
<span class="go"> &#39;QUERY_TIMEOUT_S&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;REPLICA_PREFERENCE&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;REQUEST_POOL&#39;: &#39;&#39;,</span>
<span class="go"> &#39;RUNTIME_BLOOM_FILTER_SIZE&#39;: &#39;1048576&#39;,</span>
<span class="go"> &#39;RUNTIME_FILTER_MAX_SIZE&#39;: &#39;16777216&#39;,</span>
<span class="go"> &#39;RUNTIME_FILTER_MIN_SIZE&#39;: &#39;1048576&#39;,</span>
<span class="go"> &#39;RUNTIME_FILTER_MODE&#39;: &#39;2&#39;,</span>
<span class="go"> &#39;RUNTIME_FILTER_WAIT_TIME_MS&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;S3_SKIP_INSERT_STAGING&#39;: &#39;1&#39;,</span>
<span class="go"> &#39;SCHEDULE_RANDOM_REPLICA&#39;: &#39;0&#39;,</span>
<span class="go"> &#39;SCRATCH_LIMIT&#39;: &#39;-1&#39;,</span>
<span class="go"> &#39;SEQ_COMPRESSION_MODE&#39;: &#39;&#39;,</span>
<span class="go"> &#39;SYNC_DDL&#39;: &#39;0&#39;}</span>
</pre></div>
</div>
<p>To enable Snappy compression for Parquet files, you could do either of:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [37]: </span><span class="n">client</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span><span class="s1">&#39;COMPRESSION_CODEC&#39;</span><span class="p">:</span> <span class="s1">&#39;snappy&#39;</span><span class="p">})</span>

<span class="gp">In [38]: </span><span class="n">client</span><span class="o">.</span><span class="n">set_compression_codec</span><span class="p">(</span><span class="s1">&#39;snappy&#39;</span><span class="p">)</span>

<span class="gp">In [39]: </span><span class="n">client</span><span class="o">.</span><span class="n">get_options</span><span class="p">()[</span><span class="s1">&#39;COMPRESSION_CODEC&#39;</span><span class="p">]</span>
<span class="gh">Out[39]: </span><span class="go">&#39;SNAPPY&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="ingesting-data-from-pandas">
<h2>Ingesting data from pandas<a class="headerlink" href="#ingesting-data-from-pandas" title="Permalink to this headline">¶</a></h2>
<p>Overall interoperability between the Hadoop / Spark ecosystems and pandas / the
PyData stack is poor, but it will improve in time (this is a major part of the
Ibis roadmap).</p>
<p>Ibis’s Impala tools currently interoperate with pandas in these ways:</p>
<ul class="simple">
<li><p>Ibis expressions return pandas objects (i.e. DataFrame or Series) for
non-scalar expressions when calling their <code class="docutils literal notranslate"><span class="pre">execute</span></code> method</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">create_table</span></code> and <code class="docutils literal notranslate"><span class="pre">insert</span></code> methods can accept pandas objects. This
includes inserting into partitioned tables. It currently uses CSV as the
ingest route.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="gp">In [3]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]})</span>

<span class="gp">In [4]: </span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;pandas_table&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="gp">In [5]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">pandas_table</span>

<span class="gp">In [6]: </span><span class="n">t</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gh">Out[6]:</span>
<span class="go">  bar  foo</span>
<span class="go">0   a    1</span>
<span class="go">1   b    2</span>
<span class="go">2   c    3</span>
<span class="go">3   d    4</span>

<span class="gp">In [7]: </span><span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>

<span class="gp">In [8]: </span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;empty_for_insert&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="p">())</span>

<span class="gp">In [9]: </span><span class="n">to_insert</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">empty_for_insert</span>

<span class="gp">In [10]: </span><span class="n">to_insert</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">to_insert</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gh">Out[11]:</span>
<span class="go">  bar  foo</span>
<span class="go">0   a    1</span>
<span class="go">1   b    2</span>
<span class="go">2   c    3</span>
<span class="go">3   d    4</span>

<span class="gp">In [12]: </span><span class="n">to_insert</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [40]: </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="gp">In [41]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]})</span>

<span class="gp">In [42]: </span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;pandas_table&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="gp">In [43]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">pandas_table</span>

<span class="gp">In [44]: </span><span class="n">t</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gh">Out[44]: </span><span class="go"></span>
<span class="go">   foo bar</span>
<span class="go">0    1   a</span>
<span class="go">1    2   b</span>
<span class="go">2    3   c</span>
<span class="go">3    4   d</span>

<span class="gp">In [45]: </span><span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>

<span class="gp">In [46]: </span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="s1">&#39;empty_for_insert&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="p">())</span>

<span class="gp">In [47]: </span><span class="n">to_insert</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">empty_for_insert</span>

<span class="gp">In [48]: </span><span class="n">to_insert</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [49]: </span><span class="n">to_insert</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gh">Out[49]: </span><span class="go"></span>
<span class="go">   foo bar</span>
<span class="go">0    1   a</span>
<span class="go">1    2   b</span>
<span class="go">2    3   c</span>
<span class="go">3    4   d</span>

<span class="gp">In [50]: </span><span class="n">to_insert</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="using-impala-udfs-in-ibis">
<h2>Using Impala UDFs in Ibis<a class="headerlink" href="#using-impala-udfs-in-ibis" title="Permalink to this headline">¶</a></h2>
<p>Impala currently supports user-defined scalar functions (known henceforth as
<em>UDFs</em>) and aggregate functions (respectively <em>UDAs</em>) via a C++ extension API.</p>
<p>Initial support for using C++ UDFs in Ibis came in version 0.4.0.</p>
<div class="section" id="using-scalar-functions-udfs">
<h3>Using scalar functions (UDFs)<a class="headerlink" href="#using-scalar-functions-udfs" title="Permalink to this headline">¶</a></h3>
<p>Let’s take an example to illustrate how to make a C++ UDF available to
Ibis. Here is a function that computes an approximate equality between floating
point values:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;impala_udf/udf.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;cctype&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>

<span class="n">BooleanVal</span> <span class="nf">FuzzyEquals</span><span class="p">(</span><span class="n">FunctionContext</span><span class="o">*</span> <span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="n">DoubleVal</span><span class="o">&amp;</span> <span class="n">x</span><span class="p">,</span> <span class="k">const</span> <span class="n">DoubleVal</span><span class="o">&amp;</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">0.000001f</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">is_null</span> <span class="o">||</span> <span class="n">y</span><span class="p">.</span><span class="n">is_null</span><span class="p">)</span> <span class="k">return</span> <span class="n">BooleanVal</span><span class="o">::</span><span class="n">null</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">val</span> <span class="o">-</span> <span class="n">y</span><span class="p">.</span><span class="n">val</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">BooleanVal</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="n">EPSILON</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can compile this to either a shared library (a <code class="docutils literal notranslate"><span class="pre">.so</span></code> file) or to LLVM
bitcode with clang (a <code class="docutils literal notranslate"><span class="pre">.ll</span></code> file). Skipping that step for now (will add some
more detailed instructions here later, promise).</p>
<p>To make this function callable, we use <code class="docutils literal notranslate"><span class="pre">ibis.impala.wrap_udf</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">library</span> <span class="o">=</span> <span class="s1">&#39;/ibis/udfs/udftest.ll&#39;</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">]</span>
<span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;boolean&#39;</span>
<span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;FuzzyEquals&#39;</span>
<span class="n">udf_db</span> <span class="o">=</span> <span class="s1">&#39;ibis_testing&#39;</span>
<span class="n">udf_name</span> <span class="o">=</span> <span class="s1">&#39;fuzzy_equals&#39;</span>

<span class="n">fuzzy_equals</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">impala</span><span class="o">.</span><span class="n">wrap_udf</span><span class="p">(</span>
    <span class="n">library</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">udf_name</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In typical workflows, you will set up a UDF in Impala once then use it
thenceforth. So the <em>first time</em> you do this, you need to create the UDF in
Impala:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="n">fuzzy_equals</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">udf_db</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we must register this function as a new Impala operation in Ibis. This
must take place each time you load your Ibis session.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">func</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">fuzzy_equals</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">udf_db</span><span class="p">)</span>
</pre></div>
</div>
<p>The object <code class="docutils literal notranslate"><span class="pre">fuzzy_equals</span></code> is callable and works with Ibis expressions:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="n">db</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">database</span><span class="p">(</span><span class="s1">&#39;ibis_testing&#39;</span><span class="p">)</span>

<span class="gp">In [36]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">functional_alltypes</span>

<span class="gp">In [37]: </span><span class="n">expr</span> <span class="o">=</span> <span class="n">fuzzy_equals</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">float_col</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">double_col</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>

<span class="gp">In [38]: </span><span class="n">expr</span><span class="o">.</span><span class="n">execute</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span>
<span class="gh">Out[38]:</span>
<span class="go">0     True</span>
<span class="go">1    False</span>
<span class="go">2    False</span>
<span class="go">3    False</span>
<span class="go">4    False</span>
<span class="go">5    False</span>
<span class="go">6    False</span>
<span class="go">7    False</span>
<span class="go">8    False</span>
<span class="go">9    False</span>
<span class="go">Name: tmp, dtype: bool</span>
</pre></div>
</div>
<p>Note that the call to <code class="docutils literal notranslate"><span class="pre">register</span></code> on the UDF object must happen each time you
use Ibis. If you have a lot of UDFs, I suggest you create a file with all of
your wrapper declarations and user APIs that you load with your Ibis session to
plug in all your own functions.</p>
</div>
<div class="section" id="adding-documentation-to-new-functions">
<h3>Adding documentation to new functions<a class="headerlink" href="#adding-documentation-to-new-functions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fuzzy_equal</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">Approximate equals UDF</span>

<span class="s2">Parameters</span>
<span class="s2">----------</span>
<span class="s2">left : numeric</span>
<span class="s2">right : numeric</span>

<span class="s2">Returns</span>
<span class="s2">-------</span>
<span class="s2">bool</span>

<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../generated/ibis.impala.api.ImpalaClient.database.html" class="btn btn-neutral float-right" title="ibis.impala.api.ImpalaClient.database" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../configuration.html" class="btn btn-neutral float-left" title="Configuring Ibis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Ibis Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65303298-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>
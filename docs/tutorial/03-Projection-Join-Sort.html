

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Projection, Joining, and Sorting &mdash; Ibis 1.3.0+84.g0693518 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="More Value Expressions" href="04-More-Value-Expressions.html" />
    <link rel="prev" title="Basics: Aggregation, filtering, limits" href="02-Basics-Aggregate-Filter-Limit.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ibis
          

          
            
            <img src="../_static/logo-wide.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.3.0+84.g0693518
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Installation and Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-Intro-and-Setup.html">Impala/HDFS intro and Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-Basics-Aggregate-Filter-Limit.html">Basics: Aggregation, filtering, limits</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Projection, Joining, and Sorting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Projections:-adding/selecting-columns">Projections: adding/selecting columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Joins">Joins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Joins-are-declarations-of-intent">Joins are declarations of intent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Explicit-join-materialization">Explicit join materialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Writing-down-join-keys">Writing down join keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Join-referential-nuances">Join referential nuances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Aggregating-joined-table-with-metrics-involving-more-than-one-base-reference">Aggregating joined table with metrics involving more than one base reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Sorting">Sorting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="04-More-Value-Expressions.html">More Value Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-IO-Create-Insert-External-Data.html">IO, <code class="docutils literal notranslate"><span class="pre">CREATE</span></code>/<code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, and External Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="06-Advanced-Topics-TopK-SelfJoins.html">Advanced Topics: Top-K and Self Joins</a></li>
<li class="toctree-l2"><a class="reference internal" href="07-Advanced-Topics-ComplexFiltering.html">Advanced Topics: Additional Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="08-More-Analytics-Helpers.html">Additional Analytics Tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ibis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorial</a> &raquo;</li>
        
      <li>Projection, Joining, and Sorting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/03-Projection-Join-Sort.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Projection,-Joining,-and-Sorting">
<h1>Projection, Joining, and Sorting<a class="headerlink" href="#Projection,-Joining,-and-Sorting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ibis</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">hdfs_port</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IBIS_WEBHDFS_PORT&#39;</span><span class="p">,</span> <span class="mi">50070</span><span class="p">)</span>
<span class="n">hdfs</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">hdfs_connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;impala&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">hdfs_port</span><span class="p">)</span>
<span class="n">con</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">impala</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;impala&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;ibis_testing&#39;</span><span class="p">,</span>
                          <span class="n">hdfs_client</span><span class="o">=</span><span class="n">hdfs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hello!
</pre></div></div>
</div>
</div>
<div class="section" id="Projections:-adding/selecting-columns">
<h2>Projections: adding/selecting columns<a class="headerlink" href="#Projections:-adding/selecting-columns" title="Permalink to this headline">¶</a></h2>
<p>Projections are the general way for adding new columns to tables, or selecting or removing existing ones.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;functional_alltypes&#39;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_4_0.png" src="../_images/tutorial_03-Projection-Join-Sort_4_0.png" />
</div>
</div>
<p>First, the basics: selecting columns:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">proj</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;bool_col&#39;</span><span class="p">,</span> <span class="s1">&#39;int_col&#39;</span><span class="p">,</span> <span class="s1">&#39;double_col&#39;</span><span class="p">]</span>

<span class="n">proj</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_6_0.png" src="../_images/tutorial_03-Projection-Join-Sort_6_0.png" />
</div>
</div>
<p>You can make a list of columns you want, too, and pass that:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">to_select</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bool_col&#39;</span><span class="p">,</span> <span class="s1">&#39;int_col&#39;</span><span class="p">]</span>
<span class="n">table</span><span class="p">[</span><span class="n">to_select</span><span class="p">]</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_8_0.png" src="../_images/tutorial_03-Projection-Join-Sort_8_0.png" />
</div>
</div>
<p>You can also use the explicit <code class="docutils literal notranslate"><span class="pre">projection</span></code> or <code class="docutils literal notranslate"><span class="pre">select</span></code> functions</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s1">&#39;int_col&#39;</span><span class="p">,</span> <span class="s1">&#39;double_col&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_10_0.png" src="../_images/tutorial_03-Projection-Join-Sort_10_0.png" />
</div>
</div>
<p>We can add new columns by using named column expressions</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bigger_expr</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">int_col</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;bigger_ints&#39;</span><span class="p">)</span>
<span class="n">proj2</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;int_col&#39;</span><span class="p">,</span> <span class="n">bigger_expr</span><span class="p">]</span>
<span class="n">proj2</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_12_0.png" src="../_images/tutorial_03-Projection-Join-Sort_12_0.png" />
</div>
</div>
<p>In more complicated projections involving joins, we may need to refer to all of the columns in a table at once. This is how <code class="docutils literal notranslate"><span class="pre">add_column</span></code> works. We just pass the whole table in the projection:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="p">,</span> <span class="n">bigger_expr</span><span class="p">])</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_14_0.png" src="../_images/tutorial_03-Projection-Join-Sort_14_0.png" />
</div>
</div>
<p>To use constants in projections, we have to use a special <code class="docutils literal notranslate"><span class="pre">ibis.literal</span></code> function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">foo_constant</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">literal</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">table</span><span class="o">.</span><span class="n">bigint_col</span><span class="p">,</span> <span class="n">foo_constant</span><span class="p">])</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_16_0.png" src="../_images/tutorial_03-Projection-Join-Sort_16_0.png" />
</div>
</div>
</div>
<div class="section" id="Joins">
<h2>Joins<a class="headerlink" href="#Joins" title="Permalink to this headline">¶</a></h2>
<p>Ibis attempts to provide good support for all the standard relational joins supported by Impala, Hive, and other relational databases.</p>
<ul class="simple">
<li><p>inner, outer, left, right joins</p></li>
<li><p>semi and anti-joins</p></li>
</ul>
<p>To illustrate the joins we’ll use the TPC-H tables for now</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">region</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_region&#39;</span><span class="p">)</span>
<span class="n">nation</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_nation&#39;</span><span class="p">)</span>
<span class="n">customer</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_customer&#39;</span><span class="p">)</span>
<span class="n">lineitem</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;tpch_lineitem&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">region</span></code> and <code class="docutils literal notranslate"><span class="pre">nation</span></code> are connected by their respective <code class="docutils literal notranslate"><span class="pre">regionkey</span></code> columns</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">join_expr</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">r_regionkey</span> <span class="o">==</span> <span class="n">nation</span><span class="o">.</span><span class="n">n_regionkey</span>
<span class="n">joined</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">inner_join</span><span class="p">(</span><span class="n">nation</span><span class="p">,</span> <span class="n">join_expr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you have multiple join conditions, either compose them yourself (like filters) or pass a list to the join function</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">join_exprs</span> <span class="o">=</span> <span class="p">[</span><span class="n">cond1</span><span class="p">,</span> <span class="n">cond2</span><span class="p">,</span> <span class="n">cond3</span><span class="p">]</span>
<span class="n">joined</span> <span class="o">=</span> <span class="n">table1</span><span class="o">.</span><span class="n">inner_join</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">join_exprs</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you’ve joined tables, you don’t necessarily have anything yet. I’ll put it in big letters</p>
<div class="section" id="Joins-are-declarations-of-intent">
<h3>Joins are declarations of intent<a class="headerlink" href="#Joins-are-declarations-of-intent" title="Permalink to this headline">¶</a></h3>
<p>After calling the join function (which validates the join condition, of course), you may perform any number of other operations:</p>
<ul class="simple">
<li><p>Aggregation</p></li>
<li><p>Projection</p></li>
<li><p>Filtering</p></li>
</ul>
<p>and so forth. Most importantly, depending on your schemas, the joined tables may include overlapping column names that could create a conflict if not addressed directly. Some other systems, like pandas, handle this by applying suffixes to the overlapping column names and computing the fully joined tables immediately. We don’t do this.</p>
<p>So, with the above data, suppose we just want the region name and all the nation table data. We can then make a projection on the joined reference:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table_ref</span> <span class="o">=</span> <span class="n">joined</span><span class="p">[</span><span class="n">nation</span><span class="p">,</span> <span class="n">region</span><span class="o">.</span><span class="n">r_name</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;region&#39;</span><span class="p">)]</span>
<span class="n">table_ref</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;n_nationkey&#39;, &#39;n_name&#39;, &#39;n_regionkey&#39;, &#39;n_comment&#39;, &#39;region&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table_ref</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_24_0.png" src="../_images/tutorial_03-Projection-Join-Sort_24_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">agged</span> <span class="o">=</span> <span class="n">table_ref</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">table_ref</span><span class="o">.</span><span class="n">n_name</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;nrows&#39;</span><span class="p">)],</span> <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;region&#39;</span><span class="p">])</span>
<span class="n">agged</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_25_0.png" src="../_images/tutorial_03-Projection-Join-Sort_25_0.png" />
</div>
</div>
<p>Things like <code class="docutils literal notranslate"><span class="pre">group_by</span></code> work with unmaterialized joins, too, as you would hope.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">joined</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">r_name</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_27_0.png" src="../_images/tutorial_03-Projection-Join-Sort_27_0.png" />
</div>
</div>
</div>
<div class="section" id="Explicit-join-materialization">
<h3>Explicit join materialization<a class="headerlink" href="#Explicit-join-materialization" title="Permalink to this headline">¶</a></h3>
<p>If you’re lucky enough to have two table schemas with no overlapping column names (lucky you!), the join can be <em>materialized</em> without having to perform some other relational algebra operation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">inner_join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">join_expr</span><span class="p">)</span><span class="o">.</span><span class="n">materialize</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that this is equivalent to doing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">join_expr</span><span class="p">)[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
</pre></div>
</div>
<p>i.e., joining and then selecting all columns from both joined tables. If there is a name overlap, just like with the equivalent projection, there will be an immediate error.</p>
</div>
<div class="section" id="Writing-down-join-keys">
<h3>Writing down join keys<a class="headerlink" href="#Writing-down-join-keys" title="Permalink to this headline">¶</a></h3>
<p>In addition to having explicit comparison expressions as join keys, you can also write down column names, or use expressions referencing the joined tables, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">joined</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;a_key1&#39;</span><span class="p">,</span> <span class="s1">&#39;b_key2&#39;</span><span class="p">)])</span>

<span class="n">joined2</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[(</span><span class="n">left_expr</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">)])</span>

<span class="n">joined3</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;common_key&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>These will be compared for equality when performing the join; if you want non-equality conditions in the join, you will have to form those yourself.</p>
</div>
<div class="section" id="Join-referential-nuances">
<h3>Join referential nuances<a class="headerlink" href="#Join-referential-nuances" title="Permalink to this headline">¶</a></h3>
<p>There’s nothing to stop you from doing many joins in succession, and, in fact, with complex schemas it will be to your advantage to build the joined table references for your analysis first, then reuse the objects as you go:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">joined_ref</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">key1</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">key2</span><span class="p">)</span>
               <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">key3</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">key4</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">key5</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">key6</span><span class="p">]))</span>
</pre></div>
</div>
<p>Note that, at least right now, you need to provide explicit comparison expressions (or tuples of column references) referencing the joined tables.</p>
</div>
<div class="section" id="Aggregating-joined-table-with-metrics-involving-more-than-one-base-reference">
<h3>Aggregating joined table with metrics involving more than one base reference<a class="headerlink" href="#Aggregating-joined-table-with-metrics-involving-more-than-one-base-reference" title="Permalink to this headline">¶</a></h3>
<p>Let’s consider the case similar to the SQL query</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">a</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">foo</span> <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span> <span class="n">AS</span> <span class="n">metric</span>
<span class="n">FROM</span> <span class="n">a</span>
  <span class="n">JOIN</span> <span class="n">b</span>
    <span class="n">ON</span> <span class="n">a</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">key</span>
<span class="n">GROUP</span> <span class="n">BY</span> <span class="mi">1</span>
</pre></div>
</div>
<p>I’ll use a somewhat contrived example using the data we already have to show you what this looks like. Take the <code class="docutils literal notranslate"><span class="pre">functional.alltypes</span></code> table, and suppose we want to compute the <strong>mean absolute deviation (MAD) from the hourly mean of the double_col</strong>. Silly, I know, but bear with me.</p>
<p>First, the hourly mean:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;functional_alltypes&#39;</span><span class="p">)</span>

<span class="n">hour_dim</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">timestamp_col</span><span class="o">.</span><span class="n">hour</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span>

<span class="n">hourly_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">hour_dim</span><span class="p">)</span>
               <span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">table</span><span class="o">.</span><span class="n">double_col</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;avg_double&#39;</span><span class="p">)]))</span>
<span class="n">hourly_mean</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_32_0.png" src="../_images/tutorial_03-Projection-Join-Sort_32_0.png" />
</div>
</div>
<p>Okay, great, now how about the MAD? The only trick here is that we can form an aggregate metric from the two tables, and we then have to join it later. Ibis <strong>will not</strong> figure out how to join the tables automatically for us.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mad</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">double_col</span> <span class="o">-</span> <span class="n">hourly_mean</span><span class="o">.</span><span class="n">avg_double</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;MAD&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This metric is only valid if used in the context of <code class="docutils literal notranslate"><span class="pre">table</span></code> joined with <code class="docutils literal notranslate"><span class="pre">hourly_mean</span></code>, so let’s do that. Writing down the join condition is simply a matter of writing:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">join_expr</span> <span class="o">=</span> <span class="n">hour_dim</span> <span class="o">==</span> <span class="n">hourly_mean</span><span class="o">.</span><span class="n">hour</span>
</pre></div>
</div>
</div>
<p>Now let’s compute the MAD grouped by <code class="docutils literal notranslate"><span class="pre">string_col</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">inner_join</span><span class="p">(</span><span class="n">hourly_mean</span><span class="p">,</span> <span class="n">join_expr</span><span class="p">)</span>
          <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">string_col</span><span class="p">)</span>
          <span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">mad</span><span class="p">]))</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_38_0.png" src="../_images/tutorial_03-Projection-Join-Sort_38_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Sorting">
<h2>Sorting<a class="headerlink" href="#Sorting" title="Permalink to this headline">¶</a></h2>
<p>Sorting tables works similarly to the SQL <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause. We use the <code class="docutils literal notranslate"><span class="pre">sort_by</span></code> function and pass one of the following:</p>
<ul class="simple">
<li><p>Column names</p></li>
<li><p>Column expressions</p></li>
<li><p>One of these, with a False (descending order) or True (ascending order) qualifier</p></li>
</ul>
<p>So, to sort by <code class="docutils literal notranslate"><span class="pre">total</span></code> in ascending order we write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or by <code class="docutils literal notranslate"><span class="pre">key</span></code> then by <code class="docutils literal notranslate"><span class="pre">total</span></code> in descending order</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">sort_by</span><span class="p">([</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
</pre></div>
</div>
<p>For descending sort order, there is a convenience function <code class="docutils literal notranslate"><span class="pre">desc</span></code> which can wrap sort keys</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ibis</span> <span class="kn">import</span> <span class="n">desc</span>
<span class="n">table</span><span class="o">.</span><span class="n">sort_by</span><span class="p">([</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">total</span><span class="p">)])</span>
</pre></div>
</div>
<p>Here’s a concrete example involving filters, custom grouping dimension, and sorting</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">table</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;functional_alltypes&#39;</span><span class="p">)</span>

<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;string_col&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">bigint_col</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">ifelse</span><span class="p">(</span><span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;bigint_tier&#39;</span><span class="p">)]</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">double_col</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)]</span>

<span class="n">agged</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span>
         <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">int_col</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
         <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
         <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">metrics</span><span class="p">))</span>

<span class="n">sorted_agged</span> <span class="o">=</span> <span class="n">agged</span><span class="o">.</span><span class="n">sort_by</span><span class="p">([</span><span class="s1">&#39;bigint_tier&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
<span class="n">sorted_agged</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_41_0.png" src="../_images/tutorial_03-Projection-Join-Sort_41_0.png" />
</div>
</div>
<p>For sorting in descending order, you can use the special <code class="docutils literal notranslate"><span class="pre">ibis.desc</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">agged</span><span class="o">.</span><span class="n">sort_by</span><span class="p">(</span><span class="n">ibis</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_03-Projection-Join-Sort_43_0.png" src="../_images/tutorial_03-Projection-Join-Sort_43_0.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="04-More-Value-Expressions.html" class="btn btn-neutral float-right" title="More Value Expressions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="02-Basics-Aggregate-Filter-Limit.html" class="btn btn-neutral float-left" title="Basics: Aggregation, filtering, limits" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Ibis Developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65303298-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>